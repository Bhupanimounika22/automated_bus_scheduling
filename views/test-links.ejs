<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Accept/Decline Links</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Accept/Decline Links</h1>
        <p>This page helps you test the accept/decline functionality for schedule assignments.</p>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Links</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Instructions:</strong></p>
                        <ol>
                            <li>First, create some schedules using "Auto Assign Schedules"</li>
                            <li>Copy the Schedule ID and Crew ID from the schedule list</li>
                            <li>Use the test links below to simulate accept/decline</li>
                        </ol>
                        
                        <div class="mb-3">
                            <label for="scheduleId" class="form-label">Schedule ID:</label>
                            <input type="text" class="form-control" id="scheduleId" placeholder="Enter Schedule ID">
                        </div>
                        
                        <div class="mb-3">
                            <label for="crewId" class="form-label">Crew ID:</label>
                            <input type="text" class="form-control" id="crewId" placeholder="Enter Crew ID">
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button class="btn btn-success" onclick="testAccept()">Test Accept (Yes)</button>
                            <button class="btn btn-danger" onclick="testDecline()">Test Decline (No)</button>
                        </div>
                        
                        <div id="result" class="mt-3"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Current Schedules & Crew</h5>
                    </div>
                    <div class="card-body">
                        <h6>Available Schedules:</h6>
                        <% if (schedules && schedules.length > 0) { %>
                            <div class="mb-3">
                                <% schedules.forEach(schedule => { %>
                                    <div class="border p-2 mb-2">
                                        <strong>Schedule ID:</strong> <code><%= schedule._id %></code><br>
                                        <strong>Bus:</strong> <%= schedule.busId ? schedule.busId.busId : 'N/A' %><br>
                                        <strong>Shift:</strong> <%= schedule.shift %><br>
                                        <strong>Crew:</strong>
                                        <% schedule.crewId.forEach((member, index) => { %>
                                            <br>&nbsp;&nbsp;<%= member.fullName %> (<%= member.role %>) - ID: <code><%= member._id %></code>
                                            <button class="btn btn-sm btn-success ms-2" onclick="testWithIds('<%= schedule._id %>', '<%= member._id %>', 'yes')">Test Accept</button>
                                            <button class="btn btn-sm btn-danger ms-1" onclick="testWithIds('<%= schedule._id %>', '<%= member._id %>', 'no')">Test Decline</button>
                                        <% }) %>
                                    </div>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <p>No schedules available. Create some schedules first.</p>
                        <% } %>
                        
                        <h6>Available Crew:</h6>
                        <% if (crew && crew.length > 0) { %>
                            <div class="mb-3">
                                <% crew.forEach(member => { %>
                                    <div class="border p-2 mb-1">
                                        <strong><%= member.fullName %></strong> (<%= member.role %>) - ID: <code><%= member._id %></code>
                                    </div>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <p>No crew available.</p>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <a href="/dashboard/schedule" class="btn btn-secondary">Back to Schedule Management</a>
        </div>
    </div>

    <script>
        function testAccept() {
            const scheduleId = document.getElementById('scheduleId').value;
            const crewId = document.getElementById('crewId').value;
            
            if (!scheduleId || !crewId) {
                alert('Please enter both Schedule ID and Crew ID');
                return;
            }
            
            const url = `/dashboard/schedule/accept/${scheduleId}/${crewId}/yes`;
            console.log('Testing accept URL:', url);
            
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('result').innerHTML = `
                        <div class="alert alert-success">
                            <strong>Accept Test Result:</strong><br>
                            ${data}
                        </div>
                    `;
                })
                .catch(error => {
                    document.getElementById('result').innerHTML = `
                        <div class="alert alert-danger">
                            <strong>Error:</strong><br>
                            ${error.message}
                        </div>
                    `;
                });
        }
        
        function testDecline() {
            const scheduleId = document.getElementById('scheduleId').value;
            const crewId = document.getElementById('crewId').value;
            
            if (!scheduleId || !crewId) {
                alert('Please enter both Schedule ID and Crew ID');
                return;
            }
            
            const url = `/dashboard/schedule/accept/${scheduleId}/${crewId}/no`;
            console.log('Testing decline URL:', url);
            
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('result').innerHTML = `
                        <div class="alert alert-warning">
                            <strong>Decline Test Result:</strong><br>
                            ${data}
                        </div>
                    `;
                })
                .catch(error => {
                    document.getElementById('result').innerHTML = `
                        <div class="alert alert-danger">
                            <strong>Error:</strong><br>
                            ${error.message}
                        </div>
                    `;
                });
        }
        
        function testWithIds(scheduleId, crewId, response) {
            const action = response === 'yes' ? 'Accept' : 'Decline';
            console.log(`Testing ${action.toLowerCase()} with Schedule ID: ${scheduleId}, Crew ID: ${crewId}`);
            
            const url = `/dashboard/schedule/accept/${scheduleId}/${crewId}/${response}`;
            console.log(`Testing URL: ${url}`);
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('result').innerHTML = `
                        <div class="alert alert-${response === 'yes' ? 'success' : 'warning'}">
                            <strong>${action} Test Result:</strong><br>
                            ${data}
                        </div>
                    `;
                })
                .catch(error => {
                    document.getElementById('result').innerHTML = `
                        <div class="alert alert-danger">
                            <strong>Error:</strong><br>
                            ${error.message}
                        </div>
                    `;
                });
        }
        

    </script>
</body>
</html> 